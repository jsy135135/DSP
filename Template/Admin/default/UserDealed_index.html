<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>每日话务处理情况-{$Think.config.cms_name}</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
            <link rel='stylesheet' type='text/css' href='__PUBLIC__/Admin/css/admin_style.css' />
            <script type="text/javascript" src="__PUBLIC__/js/jquery.min.js"></script>
            <script type="text/javascript" src="__PUBLIC__/Admin/js/function.js"></script>
            <script type="text/javascript" src="__PUBLIC__/Admin/js/knockout-3.2.0.js"></script>
            <style>td{ height:22px; line-height:22px border:1px;}</style>
    </head>
    <body>
        <script>
            var rawData = {$aListjson};
        </script>
        <a href="__ROOT__/index.php/Admin/UserDealed/Dindex/">未经过排重</a>
        <span class="f1"><a href="__ROOT__/index.php/Admin/Choucha/lswx/">ls无效返回数更新</a>
            <span class="f1"><a href="__ROOT__/index.php/Admin/Choucha/zfwx/">zf无效返回数更新</a>
                <span class="f1"><a href="__ROOT__/index.php/Admin/UserDealed/show/">每日分配详细查看</a>
                <table width="98%" border="0" cellpadding="9" cellspacing="1" class="table">
                    <tr>
                        <td colspan="22" class="table_title">
                            <script src="__PUBLIC__/Admin/js/jquery-ui-1.10.3.full.min.js"></script>
                            <script src="__PUBLIC__/Admin/js/jquery.ui.touch-punch.min.js"></script>
                            <!-- <link rel="stylesheet" href="__PUBLIC__/Admin/css/theme.css"> -->
                            <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
                                <script>
                    $(function () {
                        $(".date").datepicker({});
                        $.datepicker.regional['zh-CN'] = {
                            closeText: '关闭',
                            prevText: '&#x3c;上月',
                            nextText: '下月&#x3e;',
                            currentText: '今天',
                            monthNames: ['一月', '二月', '三月', '四月', '五月', '六月',
                                '七月', '八月', '九月', '十月', '十一月', '十二月'],
                            monthNamesShort: ['一', '二', '三', '四', '五', '六',
                                '七', '八', '九', '十', '十一', '十二'],
                            dayNames: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],
                            dayNamesShort: ['周日', '周一', '周二', '周三', '周四', '周五', '周六'],
                            dayNamesMin: ['日', '一', '二', '三', '四', '五', '六'],
                            weekHeader: '周',
                            dateFormat: 'yy-mm-dd',
                            firstDay: 1,
                            isRTL: false,
                            showMonthAfterYear: true,
                            yearSuffix: '年'};
                        $.datepicker.setDefaults($.datepicker.regional['zh-CN']);
                    });
                                </script>
                                <span class="fl">当前日期区间:{$startdate}----{$enddate}</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="f1">处理数据人数:{$aListcount}</span>
                                <form action="__ROOT__/index.php/Admin/UserDealed/index/" method="post">
                                    <span class="fl">开始日期:<input type="text" name="startdate" class="date" /></span>
                                    <span class="fl">结束日期:<input type="text" name="enddate" class="date" /></span>
                                    <input type="submit" value="查询" />
                                    <!-- <input type="reset" value="重选"> -->
                                </form>
                                <!-- <span class="f1"><a href="__ROOT__/index.php/Admin/DataDealed/index/period/7">7天</a></span>
                                <span class="f1"><a href="__ROOT__/index.php/Admin/DataDealed/index/period/30">30天</a></span>
                                <span class="f1"><a href="__ROOT__/index.php/Admin/DataDealed/index/period/month">本月</a></span>
                                <span class="f1"><a href="__ROOT__/index.php/Admin/DataDealed/index/period/prev">上月</a></span> -->
                                <select style="font-size:20px;"data-bind="value: filter, options: filterItems, optionsCaption: '请选择分组'"></select>
                        </td>
                    </tr>
                    <tr  class="list_head ct">
                        <!--<td>ID编号</td>-->
                        <td>客服号码</td>
                        <td>业务分组</td>
                        <!--<td>分配数量</td>-->
                        <td>首次外呼处理数</td>
                        <td>首次提交数(含特殊通道)</td>
                        <td>28转接数</td>
                        <td>28转接审核有效数</td>
                        <td>个人目标数</td>
                        <td>首次成功数</td>
                        <td>首次成功比</td>
                        <td>二次发送处理数</td>
                        <td>二次发送提交数</td>
                        <td>二次发送成功数</td>
                        <td>ls提交数</td>
                        <td>ls转接数</td>
                        <td>ls转接无效返回数</td>
                        <td>ls无效返回数</td>
                        <td>ls提交无效率</td>
                        <td>zf提交数</td>
                        <td>zf转接数</td>
                        <td>zf转接无效返回数</td>
                        <td>zf无效返回数</td>
                        <td>zf提交无效率</td>

                        <!--<td>语音地址</td>-->
                    </tr>

                    <tbody data-bind="foreach: datalist">
                        <tr class='<eq name="mod" value="1">tr<else/>ji</eq>'>
                            <!--                    <td><for start="1" end="$aListcount">
                                                        {$i}
                                                    </for></td>-->
                            <td>
                                <span data-bind="text: uid"></span>
                                <span data-bind="text: username"></span>
                            </td>
                            <td data-bind="text: section">{$vo.section}</td>
                            <!--<td data-bind="text: fpsl">{$vo.fpsl}</td>-->
                            <td data-bind="text: firstCallNum">{$vo.firstCallNum}</td>
                            <td data-bind="text: firstSendNum">{$vo.firstSendNum}</td>
                            <td data-bind="text: transfer">{$vo.transfer}</td>
                            <td data-bind="text: transferOKNum">{$vo.transferOKNum}</td>
                            <td data-bind="text: aim">{$vo.aim}</td>
                            <td data-bind="text: firstSendOKNum">{$vo.firstSendOKNum}</td>
                            <td data-bind="text: firstSendOKRatio + '%'">{$vo.firstSendOKRatio}%</td>
                            <td data-bind="text: againCallNum">{$vo.againCallNum}</td>
                            <td data-bind="text: againSubmitNum">{$vo.againSubmitNum}</td>
                            <td data-bind="text: againSubmitOkNum">{$vo.againSubmitOkNum}</td>
                            <td data-bind="text: lsSunbmitNum">{$vo.lsSunbmitNum}</td>
                            <td data-bind="text: lstransfer">{$vo.lstransfer}</td>
                            <td data-bind="text: lszjwx">{$vo.lszjwx}</td>
                            <td data-bind="text: lswx">{$vo.lswx}</td>
                            <td data-bind="text: lsSunbmitOK + '%'">{$vo.lsSunbmitOK}%</td>
                            <td data-bind="text: zfSunbmitNum">{$vo.zfSunbmitNum}</td>
                            <td data-bind="text: zftransfer">{$vo.zftransfer}</td>
                            <td data-bind="text: zfzjwx">{$vo.zfzjwx}</td>
                            <td data-bind="text: zfwx">{$vo.zfwx}</td>
                            <td data-bind="text: zfSunbmitOK + '%'">{$vo.zfSunbmitOK}%</td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td>
                                <!-- shit -->
                            </td>
                            <td>
                                <!-- shit -->
                            </td>
                            <!--<td data-bind="text: t_fpsl">{$vo.fpsl}</td>-->
                            <td data-bind="text: t_firstCallNum">{$vo.firstCallNum}</td>
                            <td data-bind="text: t_firstSendNum">{$vo.firstSendNum}</td>
                            <td data-bind="text: t_transfer"></td>
                            <td data-bind="text: t_transferOKNum"></td>
                            <td data-bind="text: t_aim">{$vo.aim}</td>
                            <td data-bind="text: t_firstSendOKNum">{$vo.firstSendOKNum}</td>
                            <td data-bind="text: t_firstSendOKRatio">{$vo.firstSendOKRatio}%</td>
                            <td data-bind="text: t_againCallNum">{$vo.againCallNum}</td>
                            <td data-bind="text: t_againSubmitNum">{$vo.againSubmitNum}</td>
                            <td data-bind="text: t_againSubmitOkNum">{$vo.againSubmitOkNum}</td>
                            <td data-bind="text: t_lsSunbmitNum">{$vo.lsSunbmitNum}</td>
                            <td data-bind="text: t_lstransfer">{$vo.lstransfer}</td>
                            <td data-bind="text: t_lszjwx">{$vo.lszjwx}</td>
                            <td data-bind="text: t_lswx">{$vo.lswx}</td>
                            <td data-bind="text: t_lsSunbmitOK">{$vo.lsSunbmitOK}%</td>
                            <td data-bind="text: t_zfSunbmitNum">{$vo.zfSunbmitNum}</td>
                            <td data-bind="text: t_zftransfer">{$vo.zftransfer}</td>
                            <td data-bind="text: t_zfzjwx">{$vo.zfzjwx}</td>
                            <td data-bind="text: t_zfwx">{$vo.zfwx}</td>
                            <td data-bind="text: t_zfSunbmitOK">{$vo.zfSunbmitOK}%</td>

                        </tr>

                        <tr>
                            <td>
                                <!-- shit -->
                            </td>
                            <td>
                                <!-- shit -->
                            </td>
                            <!--<td data-bind="text: (t_fpsl() / len()).toFixed(2)">{$vo.fpsl}</td>-->
                            <td data-bind="text: (t_firstCallNum() / len()).toFixed(2)">{$vo.firstCallNum}</td>
                            <td data-bind="text: (t_firstSendNum() / len()).toFixed(2)">{$vo.firstSendNum}</td>
                            <td data-bind="text: (t_transfer() / len()).toFixed(2)"></td>
                            <td data-bind="text: (t_transferOKNum() / len()).toFixed(2)"></td>
                            <td data-bind="text: (t_aim() / len()).toFixed(2)">{$vo.aim}</td>
                            <td data-bind="text: (t_firstSendOKNum() / len()).toFixed(2)">{$vo.firstSendOKNum}</td>
                            <td data-bind="text: t_firstSendOKRatio">{$vo.firstSendOKRatio}%</td>
                            <td data-bind="text: (t_againCallNum() / len()).toFixed(2)">{$vo.againCallNum}</td>
                            <td data-bind="text: (t_againSubmitNum() / len()).toFixed(2)">{$vo.againSubmitNum}</td>
                            <td data-bind="text: (t_againSubmitOkNum() / len()).toFixed(2)">{$vo.againSubmitOkNum}</td>
                            <td data-bind="text: (t_lsSunbmitNum() / len()).toFixed(2)">{$vo.lsSunbmitNum}</td>
                            <td data-bind="text: (t_lstransfer() / len()).toFixed(2)">{$vo.lstranfer}</td>
                            <td data-bind="text: (t_lszjwx() / len()).toFixed(2)">{$vo.lszjwx}</td>
                            <td data-bind="text: (t_lswx() / len()).toFixed(2)">{$vo.lswx}</td>
                            <td data-bind="text: t_lsSunbmitOK">{$vo.lsSunbmitOK}%</td>
                            <td data-bind="text: (t_zfSunbmitNum() / len()).toFixed(2)">{$vo.zfSunbmitNum}</td>
                            <td data-bind="text: (t_zftransfer() / len()).toFixed(2)">{$vo.zftransfer}</td>
                            <td data-bind="text: (t_zfzjwx() / len()).toFixed(2)">{$vo.zfzjwx}</td>
                            <td data-bind="text: (t_zfwx() / len()).toFixed(2)">{$vo.zfwx}</td>
                            <td data-bind="text: t_zfSunbmitOK">{$vo.zfSunbmitOK}%</td>
                        </tr>
                    </tfoot>
                    <!--            <tr id="table-result">
                                    <td>合计：</td>
                                    <td>提交数<span></span></td>
                                    <td>成功数<span></span></td>
                                    <td>成功比<span></span></td>
                                    <td>二次发送处理数<span></span></td>
                                    <td>二次发送提交数<span></span></td>
                                    <td>二次发送成功数<span></span></td>
                                </tr>
                                <tr style="visibility: hidden;">
                                    <td>客服号码</td>
                                    <td>提交数</td>
                                    <td>成功数</td>
                                    <td>成功比</td>
                                    <td>二次发送处理数</td>
                                    <td>二次发送提交数</td>
                                    <td>二次发送成功数</td>

                                </tr>-->

                </table>
                <style>
                    #table-header.pin {
                        position:fixed;
                        top: 0;
                        width: 98%;
                    }

                    #table-header.pin td {
                        padding: 0 10px;
                    }
                </style>

                <script>
                    function Vm() {
                        var self = this;
                        self.filter = ko.observable('');
                        self.rawData = rawData;

                        self.filterItems = ['勤奋', '务实', '激情', '分享', '28', '新同事'];
                        self.datalist = ko.computed(function () {
                            return self.rawData.filter(function (item, index, array) {
                                var filter = self.filter();
                                if (!filter) {
                                    return item;
                                } else {
                                    return item.section == filter;
                                }
                            });
                        });

                        self.len = ko.computed(function () {
                            return self.datalist().length;
                        });

                        self.t_firstCallNum = ko.computed(function () {
                            var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.firstCallNum;
                        });
                        return ret;
                    });

                    self.t_firstSendNum = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.firstSendNum;
                        });
                        return ret;
                    });
//                    self.t_fpsl = ko.computed(function() {
//                        var ret = 0;
//                        self.datalist().forEach(function(item, index) {
//                            ret += +item.fpsl;
//                        });
//                        return ret;
//                    });
                    self.t_aim = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.aim;
                        });
                        return ret;
                    });

                    self.t_firstSendOKNum = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.firstSendOKNum;
                        });
                        return ret;
                    });

                    self.t_firstSendOKRatio = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.firstSendOKRatio;
                        });

                        ret = (ret / self.datalist().length).toFixed(2);
                        return ret + '%';
                    });

                    self.t_againCallNum = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.againCallNum;
                        });
                        return ret;
                    });

                    self.t_againSubmitNum = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.againSubmitNum;
                        });
                        return ret;
                    });

                    self.t_againSubmitOkNum = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.againSubmitOkNum;
                        });
                        return ret;
                    });

                    self.t_lsSunbmitNum = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.lsSunbmitNum;
                        });
                        return ret;
                    });

                    self.t_lstransfer = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.lstransfer;
                        });
                        return ret;
                    });

                    self.t_lszjwx = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.lszjwx;
                        });
                        return ret;
                    });
                    self.t_lswx = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.lswx;
                        });
                        return ret;
                    });

                    self.t_lsSunbmitOK = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.lsSunbmitOK;
                        });
                        ret = (ret / self.datalist().length).toFixed(2);
                        return ret + '%';
                    });

                     self.t_zfSunbmitNum = ko.computed(function() {
                         var ret = 0;
                         self.datalist().forEach(function(item, index) {
                             ret += +item.zfSunbmitNum;
                         });
                         return ret;
                     });

                     self.t_zftransfer = ko.computed(function() {
                         var ret = 0;
                         self.datalist().forEach(function(item, index) {
                             ret += +item.zftransfer;
                         });
                         return ret;
                     });
                         self.t_zfzjwx = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.zfzjwx;
                        });
                        return ret;
                    });
                     self.t_zfwx = ko.computed(function() {
                         var ret = 0;
                         self.datalist().forEach(function(item, index) {
                             ret += +item.zfwx;
                         });
                         return ret;
                     });

                     self.t_zfSunbmitOK = ko.computed(function() {
                         var ret = 0;
                         self.datalist().forEach(function(item, index) {
                             ret += +item.zfSunbmitOK;
                         });
                         ret = (ret / self.datalist().length).toFixed(2);
                         return ret + '%';
                     });

                     self.t_transfer = ko.computed(function() {
                        var ret = 0;
                        self.datalist().forEach(function(item, index) {
                            ret += +item.transfer;
                        });
                        return ret;
                    });
                      self.t_transferOKNum = ko.computed(function() {
                         var ret = 0;
                         self.datalist().forEach(function(item, index) {
                             ret += +item.transferOKNum;
                         });
                         return ret;
                     });
                  }




                try {
                ko.applyBindings(new Vm());

                } catch(e) {
                    console.log(e);
                }

                </script>

                <script type="text/javascript">
                    var tds = $('td').slice(1);
                    var colCount = $('tr:eq(1) td').length;

                    var resultRow = $('#table-result td');

                    for (var i = 1; i < colCount; i++) {
                        total(i);
                    }
                    ;

                    function total(colNum) {
                        var result = 0;
                        tds.each(function(index, elem) {

                            var content = parseInt($(elem).html(), 10);
                            if (index % colCount == colNum && content)
                            {
                                result += content;
                            }
                        });
                        $(resultRow[colNum]).html(result);
                    }

                    //表头浮动
                    $(window).on('scroll', function(event) {
                        var scrollTop = document.body.scrollTop;
                        if (scrollTop > 100) {
                            $('#table-header').addClass('pin');
                        } else {
                            $('#table-header').removeClass('pin');
                        }
                    });
                </script>
                <script>var version = '{$Think.config.cms_var}';</script>
                <include file="Index:footer" />
                </body>
                </html>
